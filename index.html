<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>BET300 Â· Rasca y Gana (Sweet/Joker theme)</title>
<meta name="theme-color" content="#0b0f1e"/>
<style>
:root{
  --bg:#0b0f1e; --panel:#0e1128; --panel2:#0a0d20; --border:#1b1f45;
  --text:#f7f9ff; --muted:#b7b9d6; --ok:#25D366; --accent:#ff8bd2; --gold:#ffd76a;
}
*{box-sizing:border-box;margin:0;padding:0}
body{color:var(--text);background:var(--bg);font:15px/1.42 system-ui,-apple-system,Segoe UI,Roboto}

/* ===== Hero background (temÃ¡tico) ===== */
.hero{position:relative;isolation:isolate}
.hero::before{content:"";position:fixed;inset:0;z-index:-2;background:
  radial-gradient(900px 500px at 50% -10%, rgba(255,215,106,.20), transparent),
  radial-gradient(700px 350px at 100% 0%, rgba(124,77,255,.16), transparent),
  var(--bg)}
.hero::after{content:"";position:fixed;inset:-10% -10% 40% -10%;z-index:-1;background:url('img/theme/sweet-bg.jpg') center/cover no-repeat;opacity:.22;filter:saturate(1.1)}

.container{max-width:920px;margin:10px auto;padding:0 10px 82px}
.card{background:linear-gradient(180deg, rgba(255, 215, 106, .08), rgba(0,0,0,0)), var(--panel2);border:1px solid var(--border);border-radius:16px;padding:14px}

.head{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.left{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.brand{height:28px}
.pill{background:linear-gradient(90deg,rgba(255,212,96,.18),rgba(124,77,255,.18));border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}
.pill.time{display:flex;gap:8px;align-items:center}
.pill.sound{cursor:pointer}
.count{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;background:rgba(255,204,0,.18);border:1px solid rgba(255,204,0,.35);color:#ffe27a;font-weight:800}
.head-cta{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;font-weight:800;color:#0a0f20;text-decoration:none;background:linear-gradient(90deg,#6c59ff,#00d1ff)}

.grid{display:grid;gap:14px;grid-template-columns:1.05fr .95fr}
@media(max-width:920px){.grid{grid-template-columns:1fr}}

.panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}

/* ===== Raspaditas tipo "Sweet / Joker" ===== */
.scratch-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:8px}
@media(max-width:700px){.scratch-grid{grid-template-columns:repeat(2,1fr)}}

.ticket{position:relative;border-radius:16px;overflow:hidden;border:0;isolation:isolate;aspect-ratio:1/1;min-height:150px}
.ticket .bg{position:absolute;inset:0;background:url('img/theme/leather.jpg') center/cover no-repeat;filter:brightness(.9) saturate(.9)}
.ticket .icon{position:absolute;inset:0;display:grid;place-items:center;padding:10px;z-index:1}
.ticket .icon img{max-width:80%;max-height:80%;object-fit:contain;filter:drop-shadow(0 8px 18px rgba(0,0,0,.45))}
.ticket .badge{position:absolute;left:10px;bottom:10px;z-index:2;background:rgba(255,180,0,.95);color:#111;padding:6px 10px;border-radius:10px;font-weight:900}
/* capa de raspado */
.ticket canvas{position:absolute;inset:0;width:100%;height:100%;z-index:3;background:repeating-linear-gradient(45deg,#c4c7cf 0 8px,#b7bac2 8px 16px);box-shadow: inset 0 0 32px rgba(0,0,0,.35);cursor:crosshair;border-radius:16px}
.ticket.disabled canvas{pointer-events:none;filter:grayscale(1);opacity:.55}
.ticket.won{outline:3px solid #ffd166}

/* ===== Lateral derecho ===== */
.right h2{font-size:22px;margin:0 0 6px}
.right p{margin:0 0 6px;color:var(--muted)}
.promo{margin-top:10px;padding:12px;border:1px dashed var(--border);border-radius:12px;display:grid;gap:6px}

/* Modal del premio */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:100}
.modal .box{background:linear-gradient(180deg,#101836,#0c102a);border:1px solid #1a214b;border-radius:16px;padding:18px 16px;max-width:420px;width:92%;box-shadow:0 20px 50px rgba(0,0,0,.6)}
.modal .top{display:flex;align-items:center;gap:10px}
.modal .prize{font-size:22px;font-weight:900;background:linear-gradient(90deg,#ffd166,#ff7a3d);color:#0b0f1e;padding:4px 10px;border-radius:8px}
.modal .actions{display:flex;gap:10px;margin-top:12px}
.modal .actions a{flex:1;text-align:center;padding:12px;border-radius:10px;font-weight:800;text-decoration:none}
.modal .whatsapp{background:#25D366;color:#0b0f1e}
.modal .enter{background:linear-gradient(90deg,#6c59ff,#00d1ff);color:#0b0f1e}
.modal .close{position:absolute;top:10px;right:12px;cursor:pointer}

/* Dock aparece solo tras ganar */
.dock{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(180deg, rgba(11,15,30,0) 0%, rgba(11,15,30,.85) 22%, rgba(11,15,30,.95) 100%);padding:8px 12px 12px;display:none;gap:10px}
.btn{appearance:none;border:none;cursor:pointer;padding:12px 14px;border-radius:12px;font-weight:800}
.btn.ok{background:#25D366;color:#0b0f1e}
</style>
</head>
<body class="hero">
<div class="container">
  <div class="card">
    <div class="head">
      <div class="left">
        <img class="brand" src="img/logo-bet300.svg" alt="BET300" onerror="this.outerHTML='<strong>BET300</strong>'">
        <span class="pill">Promo interactiva</span>
        <span class="pill time">âš¡ Tiempo limitado <span class="count" id="countdown">--:--</span></span>
        <span class="pill sound" id="soundToggle">ðŸ”Š Sonido: <b id="soundState">ON</b></span>
      </div>
      <a id="playNowTop" class="head-cta" target="_blank" rel="noopener">ðŸŽ® Entrar</a>
    </div>

    <div class="grid">
      <div class="panel">
        <p>Raspadita temÃ¡tica. TenÃ©s <b id="triesLeft">1</b> intento para elegir una.</p>
        <div class="scratch-grid" id="scratchGrid">
          <!-- 6 tarjetas -->
          <div class="ticket" data-idx="0"><div class="bg"></div><div class="icon"><img src="img/icons/joker.png" alt="joker" onerror="this.style.opacity=.2"></div><div class="badge" id="b0">â€”</div><canvas id="c0"></canvas></div>
          <div class="ticket" data-idx="1"><div class="bg"></div><div class="icon"><img src="img/icons/lollipop.png" alt="lollipop" onerror="this.style.opacity=.2"></div><div class="badge" id="b1">â€”</div><canvas id="c1"></canvas></div>
          <div class="ticket" data-idx="2"><div class="bg"></div><div class="icon"><img src="img/icons/scatter.png" alt="scatter" onerror="this.style.opacity=.2"></div><div class="badge" id="b2">â€”</div><canvas id="c2"></canvas></div>
          <div class="ticket" data-idx="3"><div class="bg"></div><div class="icon"><img src="img/icons/zeus.png" alt="zeus" onerror="this.style.opacity=.2"></div><div class="badge" id="b3">â€”</div><canvas id="c3"></canvas></div>
          <div class="ticket" data-idx="4"><div class="bg"></div><div class="icon"><img src="img/icons/elf.png" alt="elf" onerror="this.style.opacity=.2"></div><div class="badge" id="b4">â€”</div><canvas id="c4"></canvas></div>
          <div class="ticket" data-idx="5"><div class="bg"></div><div class="icon"><img src="img/icons/bigbass.png" alt="bigbass" onerror="this.style.opacity=.2"></div><div class="badge" id="b5">â€”</div><canvas id="c5"></canvas></div>
        </div>
      </div>

      <div class="panel right">
        <h2>Raspadita Ganadora</h2>
        <p>Los premios se acreditan con tu <b>prÃ³xima carga mÃ­nima</b>.</p>
        <div class="promo">
          <span class="muted" style="font-weight:700">Acceso especial</span>
          <strong>Tiempo limitado.</strong>
          <span class="muted">EntrÃ¡ y participÃ¡ antes de que termine.</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal premio -->
<div id="prizeModal" class="modal">
  <div class="box">
    <div class="close" onclick="closeModal()">âœ–</div>
    <div class="top"><h3 style="margin:0">ðŸŽ‰ Â¡Premio obtenido!</h3> <span id="prizeValue" class="prize"></span></div>
    <p id="prizeText" style="margin-top:6px" class="muted"></p>
    <p id="prizeCode" class="muted" style="font-size:12px"></p>
    <div class="actions">
      <a id="claimBtn" class="whatsapp" target="_blank">ðŸ“² Reclamar</a>
      <a id="enterBtn" class="enter" target="_blank">ðŸŽ® Entrar</a>
    </div>
  </div>
</div>

<div id="dock" class="dock"><button id="claimBtnDock" class="btn ok" disabled>ðŸ“² Reclamar</button></div>

<script>
// ===== Assets/tema =====
// ColocÃ¡ tus imÃ¡genes en /img/theme y /img/icons con los nombres usados arriba
// Si no tenÃ©s leather.jpg o sweet-bg.jpg, dejÃ© degradÃ©s de fallback.

// ===== Config =====
const THRESHOLD = 0.55; // porcentaje de raspado
const ONE_PER_DAY = true; // un intento por dÃ­a
const SALT = 'bet300-rasca6-v1';
const PRIZES = ["$100","$500","$200","$100","10%","20%"]; // labels visibles en cada badge

// WhatsApp/Plataforma por pc
const WP={principal:"5491157737173",pc1:"5491138601132",pc2:"5491138214312",pc3:"5491166306349"};
const PL={principal:"https://plataforma.example/inicio",pc1:"https://c01.bet300vip.com/",pc2:"https://c02.bet300vip.com/",pc3:"https://c03.bet300vip.com/"};
const params=new URLSearchParams(location.search);const pc=params.get('pc');
let WA=WP.principal, PLATFORM=PL.principal;
if(pc==='1'){WA=WP.pc1;PLATFORM=PL.pc1}
if(pc==='2'){WA=WP.pc2;PLATFORM=PL.pc2}
if(pc==='3'){WA=WP.pc3;PLATFORM=PL.pc3}

document.getElementById('playNowTop').href = PLATFORM; document.getElementById('enterBtn').href = PLATFORM;

// ===== Countdown =====
function endOfDay(){ const n=new Date(); return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,0,0).getTime(); }
function tickCountdown(){ const el=document.getElementById('countdown'); const ms=endOfDay()-Date.now(); const total=Math.max(0,Math.floor(ms/1000)); const h=Math.floor(total/3600), m=Math.floor((total%3600)/60), s=total%60; el.textContent=h>0?`${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`:`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
setInterval(tickCountdown,1000); tickCountdown();

// ===== Storage =====
function todayKey(){const n=new Date();return `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`}
const S_PLAY='rasca6_done', S_DATE='rasca6_date', S_PRIZE='rasca6_prize', S_CODE='rasca6_code', S_TS='rasca6_ts';
function dailyResetIfNeeded(){ const today=todayKey(); const d=localStorage.getItem(S_DATE); if(!d){localStorage.setItem(S_DATE,today);} else if(d!==today){ [S_PLAY,S_PRIZE,S_CODE,S_TS].forEach(k=>localStorage.removeItem(k)); localStorage.setItem(S_DATE,today);} }
function alreadyPlayed(){ return ONE_PER_DAY && localStorage.getItem(S_PLAY)==='1'; }

dailyResetIfNeeded();

// ===== Utils =====
function tsString(d=new Date()){ const dd=String(d.getDate()).padStart(2,'0'),mm=String(d.getMonth()+1).padStart(2,'0'),yyyy=d.getFullYear(); const hh=String(d.getHours()).padStart(2,'0'),mi=String(d.getMinutes()).padStart(2,'0'); return `${dd}/${mm}/${yyyy} ${hh}:${mi}`; }
async function sha256hex(msg){ const enc=new TextEncoder().encode(msg); const buf=await crypto.subtle.digest('SHA-256',enc); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join('').toUpperCase(); }
async function makeClaimCode(prize){ const base=`${todayKey()}|${prize}|pc:${pc||'0'}|${SALT}`; const hex=await sha256hex(base); return hex.slice(0,10); }

// ===== Scratch =====
const cvs=[c0,c1,c2,c3,c4,c5]; const badges=[b0,b1,b2,b3,b4,b5];
let chosenPrize=null; let locked=false;

function sizeCanvas(cv){ const holder=cv.parentElement; const w=holder.clientWidth||160; const h=holder.clientHeight||w; const dpr=window.devicePixelRatio||1; cv.width=Math.floor(w*dpr); cv.height=Math.floor(h*dpr); cv.style.width=w+'px'; cv.style.height=h+'px'; const ctx=cv.getContext('2d'); ctx.setTransform(dpr,0,0,dpr,0,0); ctx.globalCompositeOperation='source-over'; ctx.fillStyle='#bfc3cc'; ctx.fillRect(0,0,w,h); }
function cleared(cv){ const ctx=cv.getContext('2d'); const w=cv.clientWidth, h=cv.clientHeight; const step=10; const data=ctx.getImageData(0,0,w,h).data; let c=0,t=0; for(let y=0;y<h;y+=step){ for(let x=0;x<w;x+=step){ const a=data[((y*w+x)*4)+3]; t++; if(a<16) c++; }} return c/t; }

function attach(cv, idx){ sizeCanvas(cv); const ctx=cv.getContext('2d'); let scratching=false, rect; const draw=(x,y)=>{ ctx.globalCompositeOperation='destination-out'; ctx.beginPath(); ctx.arc(x,y, 24, 0, Math.PI*2); ctx.fill(); };
  const start=(ev)=>{ if(locked||alreadyPlayed()) return; ev.preventDefault(); rect=cv.getBoundingClientRect(); scratching=true; };
  const move =(ev)=>{ if(!scratching) return; const e=ev.touches?ev.touches[0]:ev; draw(e.clientX-rect.left, e.clientY-rect.top); };
  const end  =()=>{ if(!scratching) return; scratching=false; if(cleared(cv)>=THRESHOLD){ onReveal(idx); } };
  cv.addEventListener('mousedown',start); cv.addEventListener('mousemove',move); window.addEventListener('mouseup',end);
  cv.addEventListener('touchstart',start,{passive:false}); cv.addEventListener('touchmove',move,{passive:false}); window.addEventListener('touchend',end);
}

async function onReveal(idx){ if(alreadyPlayed()) return; locked=true; document.querySelectorAll('.ticket').forEach((el,i)=>{ if(i!==idx) el.classList.add('disabled'); else el.classList.add('won'); }); chosenPrize = PRIZES[idx]; const code=await makeClaimCode(chosenPrize); const ts=tsString(); localStorage.setItem(S_CODE,code); localStorage.setItem(S_TS,ts); localStorage.setItem(S_PRIZE, JSON.stringify({label:chosenPrize})); localStorage.setItem(S_PLAY,'1');
  // Modal
  prizeValue.textContent = chosenPrize; prizeText.innerHTML = 'Se acredita con tu <b>prÃ³xima carga mÃ­nima</b>.'; prizeCode.textContent=`CÃ³digo: ${code} Â· ${ts}`; claimBtn.href=`https://wa.me/${WA}?text=${encodeURIComponent(`Hola, ganÃ© ${chosenPrize} en la raspadita. CÃ³digo: ${code} Â· ${ts}`)}`; document.getElementById('prizeModal').style.display='flex';
  // Dock
  dock.style.display='flex'; claimBtnDock.disabled=false; claimBtnDock.onclick=()=>location.href=`https://wa.me/${WA}?text=${encodeURIComponent(`Hola, ganÃ© ${chosenPrize} en la raspadita. CÃ³digo: ${code} Â· ${ts}`)}`;
}
function closeModal(){ document.getElementById('prizeModal').style.display='none'; }

function restoreIfPlayed(){ if(!alreadyPlayed()) return; const saved=localStorage.getItem(S_PRIZE); if(!saved) return; const p=JSON.parse(saved); chosenPrize=p.label; document.querySelectorAll('.ticket').forEach(el=>el.classList.add('disabled')); dock.style.display='flex'; claimBtnDock.disabled=false; const code=localStorage.getItem(S_CODE)||'â€”'; const ts=localStorage.getItem(S_TS)||tsString(); claimBtnDock.onclick=()=>location.href=`https://wa.me/${WA}?text=${encodeURIComponent(`Hola, ganÃ© ${chosenPrize} en la raspadita. CÃ³digo: ${code} Â· ${ts}`)}`; }

// init
(function init(){
  // poner badges (labels visibles)
  badges.forEach((el,i)=> el.textContent = PRIZES[i] );
  cvs.forEach((cv,i)=> attach(cv,i));
  restoreIfPlayed();
})();
</script>
</body>
</html>
