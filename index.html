<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>BET300 Â· Rasca y Gana</title>
<meta name="theme-color" content="#0b0f1e"/>
<style>
:root{
  --bg:#0b0f1e; --panel:#121634; --panel2:#0f1330; --border:#1e2150;
  --text:#e8ebff; --muted:#b7b9d6; --ok:#25D366; --pointer:#22d3ee; --gold:#ffd76a;
  --shadow:0 12px 28px rgba(0,0,0,.45);
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--text);background:var(--bg);font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto}
body::before{content:"";position:fixed;inset:0;z-index:-2;background:
  radial-gradient(900px 500px at 50% -10%, rgba(255,215,106,.25), transparent),
  radial-gradient(700px 350px at 100% 0%, rgba(124,77,255,.18), transparent),
  linear-gradient(180deg,#0b0f1e 0%,#0b0f1e 60%,#0a0d20 100%);
}
.container{max-width:980px;margin:10px auto;padding:0 10px 84px}
@media(max-width:420px){.container{padding:0 8px 78px;margin:6px auto}}
.card{background:linear-gradient(180deg, rgba(255, 215, 106, .06), rgba(0,0,0,0)), var(--panel2);
  border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
@media(max-width:420px){.card{border-radius:12px;padding:12px}}

.head{display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap;justify-content:space-between}
.head-left{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.brand{height:28px;width:auto;filter:drop-shadow(0 2px 8px rgba(0,0,0,.4))}
.pill{background:linear-gradient(90deg,rgba(255,212,96,.15),rgba(124,77,255,.15));border:1px solid var(--border);
  border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}
@media(max-width:420px){.pill{padding:4px 8px;font-size:11px}}
.pill.time{display:flex;gap:8px;align-items:center}
.pill.sound{cursor:pointer;user-select:none}
.count{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;background:rgba(255,204,0,.15);
  border:1px solid rgba(255,204,0,.35);color:#ffe27a;font-weight:700;font-variant-numeric:tabular-nums}
.head-cta{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;font-weight:800;color:#0a0f20;text-decoration:none;background:linear-gradient(90deg,#6c59ff,#00d1ff)}

.grid{display:grid;gap:16px;grid-template-columns:1.1fr .9fr}
@media(max-width:900px){.grid{grid-template-columns:1fr;gap:12px}}
@media(max-width:420px){.grid{gap:10px}}

.panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
@media(max-width:420px){.panel{border-radius:12px;padding:12px}}
.center{text-align:center}
h1,h2,h3,p{margin:0 0 8px} h1{font-size:24px} .muted{color:var(--muted)}

/* === Zona de raspaditas (4 tarjetas) === */
.scratch-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
@media(max-width:900px){.scratch-grid{grid-template-columns:repeat(2,1fr);gap:10px}}
@media(max-width:420px){.scratch-grid{grid-template-columns:repeat(2,1fr);gap:8px}}

.ticket{position:relative;border-radius:16px;overflow:hidden;border:2px solid var(--gold);
  background:linear-gradient(180deg, rgba(255, 215, 106, .08), rgba(0,0,0,0)), var(--panel2);
  aspect-ratio: 1/1; min-height: 150px; box-shadow:var(--shadow)}
@media(max-width:820px){.ticket{min-height:140px}}
@media(max-width:420px){.ticket{min-height:120px}}
/* Capa de premio visible debajo del raspado */
.ticket .prize-layer{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;text-align:center;padding:10px}
.ticket .prize-layer h3{font-size:clamp(16px,3.8vw,20px)}
.ticket .prize-layer small{color:var(--muted);font-size:12px}
.ticket .hint{position:absolute;top:8px;right:8px;opacity:.8}
.ticket canvas{position:absolute;inset:0;width:100%;height:100%;display:block;
  background:repeating-linear-gradient(45deg,#c4c7cf 0 8px,#b7bac2 8px 16px);box-shadow: inset 0 0 32px rgba(0,0,0,.35);cursor:crosshair}
.ticket.disabled canvas{pointer-events:none;filter:grayscale(1);opacity:.55}
.ticket.won{outline:2px solid var(--gold)}

/* Modal de premio */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:100}
.modal .box{background:linear-gradient(180deg,#102030,#0b0f1e);border-radius:16px;padding:20px;max-width:420px;width:92%;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,.6)}
.modal h2{margin:0 0 10px;font-size:20px;display:flex;align-items:center;gap:6px}
.modal .prize{font-size:22px;font-weight:800;background:linear-gradient(90deg,#ffd166,#ff7a3d);color:#0b0f1e;padding:4px 10px;border-radius:8px}
.modal .actions{display:flex;gap:10px;margin-top:14px}
.modal .actions a{flex:1;text-align:center;padding:12px 14px;border-radius:10px;font-weight:700;color:#0b0f1e;text-decoration:none}
.modal .whatsapp{background:#25D366;color:#0b0f1e}
.modal .enter{background:linear-gradient(90deg,#6c59ff,#00d1ff);color:#0b0f1e}
.modal .close{position:absolute;top:12px;right:12px;cursor:pointer}

/* Dock: solo aparece tras ganar (menos amontonado) */
.dock{position:fixed;left:0;right:0;bottom:0;z-index:10;background:linear-gradient(180deg, rgba(11,15,30,0) 0%, rgba(11,15,30,.85) 22%, rgba(11,15,30,.95) 100%);
  padding:8px 12px 12px;display:none;gap:10px;align-items:center}
@media(max-width:420px){.dock{padding:8px 10px 10px;gap:8px}}
.btn{appearance:none;border:none;cursor:pointer;padding:12px 14px;border-radius:12px;font-weight:800;background:linear-gradient(90deg,#6c59ff,#00d1ff);color:#0a0f20;width:100%;
  box-shadow:0 8px 20px rgba(0,0,0,.35)}
@media(max-width:420px){.btn{padding:11px 12px;border-radius:10px}}
.btn.ok{background:#25D366;color:#0b0f1e}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="head">
      <div class="head-left">
        <img class="brand" src="img/logo-bet300.svg" alt="BET300" onerror="this.outerHTML='<strong>BET300</strong>'">
        <span class="pill">Promo interactiva</span>
        <span class="pill time">âš¡ Tiempo limitado <span class="count" id="countdown">--:--</span></span>
        <span class="pill sound" id="soundToggle">ðŸ”Š Sonido: <b id="soundState">ON</b></span>
      </div>
      <a id="playNowTop" class="head-cta" target="_blank" rel="noopener">ðŸŽ® Entrar</a>
    </div>

    <div class="grid">
      <div class="panel">
        <p>TenÃ©s 1 raspe disponible para elegir <b>una</b> tarjeta.</p>
        <div class="scratch-grid" id="scratchGrid">
          <div class="ticket"><div class="prize-layer"><span class="hint">ðŸª„</span><small>RaspÃ¡ para revelar</small><h3 id="p0">â€”</h3><small>Con tu prÃ³xima carga mÃ­nima</small></div><canvas id="c0"></canvas></div>
          <div class="ticket"><div class="prize-layer"><span class="hint">ðŸª„</span><small>RaspÃ¡ para revelar</small><h3 id="p1">â€”</h3><small>Con tu prÃ³xima carga mÃ­nima</small></div><canvas id="c1"></canvas></div>
          <div class="ticket"><div class="prize-layer"><span class="hint">ðŸª„</span><small>RaspÃ¡ para revelar</small><h3 id="p2">â€”</h3><small>Con tu prÃ³xima carga mÃ­nima</small></div><canvas id="c2"></canvas></div>
          <div class="ticket"><div class="prize-layer"><span class="hint">ðŸª„</span><small>RaspÃ¡ para revelar</small><h3 id="p3">â€”</h3><small>Con tu prÃ³xima carga mÃ­nima</small></div><canvas id="c3"></canvas></div>
        </div>
      </div>
      <div class="panel">
        <div class="center">
          <h2>Rasca y Gana Â· 4 opciones</h2>
          <p class="muted">Los premios se acreditan con tu <b>prÃ³xima carga mÃ­nima</b>.</p>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="prizeModal" class="modal" style="display:none">
  <div class="box">
    <div class="close" onclick="closeModal()">âœ–</div>
    <h2>ðŸŽ‰ Â¡Premio obtenido! <span id="prizeValue" class="prize"></span></h2>
    <p id="prizeText"></p>
    <p class="muted" id="prizeCode"></p>
    <div class="actions">
      <a id="claimBtn" class="whatsapp" target="_blank">ðŸ“² Reclamar por WhatsApp</a>
      <a id="enterBtn" class="enter" target="_blank">ðŸŽ® Entrar</a>
    </div>
  </div>
</div>
<!-- Dock inferior: se muestra tras ganar -->
<div id="dock" class="dock">
  <button id="claimBtnDock" class="btn ok" disabled>ðŸ“² Reclamar</button>
</div>
<script>
// ===== Config =====
const PRIZES_POOL = ["$2000","$3000","$5000","$7000","Upgrade de Bono","Tirada de Ruleta"];
const THRESHOLD = 0.55; // porcentaje de Ã¡rea raspada para validar
const ONE_PER_DAY = true;
const SALT = 'bet300-rasca4-v1';

// WhatsApp/Plataforma por pc
const WP={principal:"5491157737173",pc1:"5491138601132",pc2:"5491138214312",pc3:"5491166306349"};
const PL={principal:"https://plataforma.example/inicio",pc1:"https://c01.bet300vip.com/",pc2:"https://c02.bet300vip.com/",pc3:"https://c03.bet300vip.com/"};
const params=new URLSearchParams(location.search);const pc=params.get('pc');
let WA=WP.principal, PLATFORM=PL.principal;
if(pc==='1'){WA=WP.pc1;PLATFORM=PL.pc1}
if(pc==='2'){WA=WP.pc2;PLATFORM=PL.pc2}
if(pc==='3'){WA=WP.pc3;PLATFORM=PL.pc3}

document.getElementById('playNowTop').href = PLATFORM;
document.getElementById('enterBtn').href = PLATFORM;

// ===== Countdown fin de dÃ­a =====
function endOfDay(){ const n=new Date(); return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,0,0).getTime(); }
function tickCountdown(){ const el=document.getElementById('countdown'); const ms=endOfDay()-Date.now(); const total=Math.max(0,Math.floor(ms/1000)); const h=Math.floor(total/3600), m=Math.floor((total%3600)/60), s=total%60; el.textContent=h>0?`${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`:`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
setInterval(tickCountdown,1000); tickCountdown();

// ===== Storage =====
function todayKey(){const n=new Date();return `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`}
const S_PLAY='rasca4_done', S_DATE='rasca4_date', S_PRIZE='rasca4_prize', S_CODE='rasca4_code', S_TS='rasca4_ts';
function dailyResetIfNeeded(){ const today=todayKey(); const d=localStorage.getItem(S_DATE); if(!d){localStorage.setItem(S_DATE,today);} else if(d!==today){ [S_PLAY,S_PRIZE,S_CODE,S_TS].forEach(k=>localStorage.removeItem(k)); localStorage.setItem(S_DATE,today);} }
function alreadyPlayed(){ return ONE_PER_DAY && localStorage.getItem(S_PLAY)==='1'; }

dailyResetIfNeeded();

// ===== Util =====
function rnd(n){ return Math.floor(Math.random()*n); }
function pickWeighted(list){ return list[rnd(list.length)]; }
function makeFour(pool){ const res=[]; const used=new Set(); while(res.length<4){ const p=pickWeighted(pool); if(!used.has(p) || pool.length<4){ res.push(p); used.add(p);} }
  return res; }
function tsString(d=new Date()){ const dd=String(d.getDate()).padStart(2,'0'),mm=String(d.getMonth()+1).padStart(2,'0'),yyyy=d.getFullYear(); const hh=String(d.getHours()).padStart(2,'0'),mi=String(d.getMinutes()).padStart(2,'0'); return `${dd}/${mm}/${yyyy} ${hh}:${mi}`; }
async function sha256hex(msg){ const enc=new TextEncoder().encode(msg); const buf=await crypto.subtle.digest('SHA-256',enc); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join('').toUpperCase(); }
async function makeClaimCode(prize){ const base=`${todayKey()}|${prize}|pc:${pc||'0'}|${SALT}`; const hex=await sha256hex(base); return hex.slice(0,10); }

// ===== Scratch =====
const tickets=[
  {cv:document.getElementById('c0'), label:document.getElementById('p0')},
  {cv:document.getElementById('c1'), label:document.getElementById('p1')},
  {cv:document.getElementById('c2'), label:document.getElementById('p2')},
  {cv:document.getElementById('c3'), label:document.getElementById('p3')},
];

let chosenPrize=null; let locked=false;

function sizeCanvas(cv){
  const holder=cv.parentElement; const w=holder.clientWidth||160; const h=holder.clientHeight||w; const dpr=window.devicePixelRatio||1;
  cv.width=Math.floor(w*dpr); cv.height=Math.floor(h*dpr); cv.style.width=w+'px'; cv.style.height=h+'px';
  const ctx=cv.getContext('2d'); ctx.setTransform(dpr,0,0,dpr,0,0); ctx.globalCompositeOperation='source-over'; ctx.fillStyle='#bfc3cc'; ctx.fillRect(0,0,w,h);
}

function getClearedPercent(cv){ const ctx=cv.getContext('2d'); const w=cv.clientWidth, h=cv.clientHeight; const step=10; const data=ctx.getImageData(0,0,w,h).data; let cleared=0,total=0; for(let y=0;y<h;y+=step){ for(let x=0;x<w;x+=step){ const a=data[((y*w+x)*4)+3]; total++; if(a<16) cleared++; }} return cleared/total; }

function attachScratch(t,idx){
  sizeCanvas(t.cv);
  const ctx=t.cv.getContext('2d'); let scratching=false, rect;
  const pointer=(ev)=>{ const e=ev.touches?ev.touches[0]:ev; const x=(e.clientX-rect.left); const y=(e.clientY-rect.top); ctx.globalCompositeOperation='destination-out'; ctx.beginPath(); ctx.arc(x,y, 22, 0, Math.PI*2); ctx.fill(); };
  const start=(ev)=>{ if(locked) return; ev.preventDefault(); rect=t.cv.getBoundingClientRect(); scratching=true; };
  const move =(ev)=>{ if(!scratching) return; pointer(ev); };
  const end  =()=>{ if(!scratching) return; scratching=false; const p=getClearedPercent(t.cv); if(p>=THRESHOLD){ onReveal(idx); } };

  t.cv.addEventListener('mousedown',start); t.cv.addEventListener('mousemove',move); window.addEventListener('mouseup',end);
  t.cv.addEventListener('touchstart',start,{passive:false}); t.cv.addEventListener('touchmove',move,{passive:false}); window.addEventListener('touchend',end);
}

function disableOthers(winnerIdx){ document.querySelectorAll('.ticket').forEach((el,i)=>{ if(i!==winnerIdx){ el.classList.add('disabled'); } else { el.classList.add('won'); } }); locked=true; }

async function onReveal(idx){
  if(alreadyPlayed()) return; // 1 por dÃ­a
  if(!chosenPrize){ chosenPrize = document.getElementById('p'+idx).textContent; }
  disableOthers(idx);
  const code = await makeClaimCode(chosenPrize); const ts = tsString();
  localStorage.setItem(S_CODE, code); localStorage.setItem(S_TS, ts);
  localStorage.setItem(S_PRIZE, JSON.stringify({label:chosenPrize}));
  localStorage.setItem(S_PLAY, '1');

  // Modal con premio asignado
  document.getElementById('prizeValue').textContent = chosenPrize;
  document.getElementById('prizeText').innerHTML = `Se acredita con tu <b>prÃ³xima carga mÃ­nima</b>.`;
  document.getElementById('prizeCode').textContent = `CÃ³digo: ${code} Â· ${ts}`;
  document.getElementById('claimBtn').href = `https://wa.me/${WA}?text=${encodeURIComponent(`Hola, ganÃ© ${chosenPrize} en la raspadita. CÃ³digo: ${code} Â· ${ts}`)}`;
  document.getElementById('prizeModal').style.display='flex';

  // Dock inferior: sÃ³lo tras ganar
  const dock=document.getElementById('dock'); dock.style.display='flex';
  const claimDock=document.getElementById('claimBtnDock'); claimDock.disabled=false; claimDock.onclick=()=>{ location.href=`https://wa.me/${WA}?text=${encodeURIComponent(`Hola, ganÃ© ${chosenPrize} en la raspadita. CÃ³digo: ${code} Â· ${ts}`)}` };
}

function closeModal(){ document.getElementById('prizeModal').style.display='none'; }

function restoreIfPlayed(){
  if(!alreadyPlayed()) return;
  const saved=localStorage.getItem(S_PRIZE); if(!saved) return;
  const p=JSON.parse(saved); const code=localStorage.getItem(S_CODE)||'â€”'; const ts=localStorage.getItem(S_TS)||tsString();
  chosenPrize=p.label; locked=true;
  document.querySelectorAll('.ticket').forEach(el=>el.classList.add('disabled'));
  document.getElementById('dock').style.display='flex';
  const claimDock=document.getElementById('claimBtnDock'); claimDock.disabled=false; claimDock.onclick=()=>{ location.href=`https://wa.me/${WA}?text=${encodeURIComponent(`Hola, ganÃ© ${chosenPrize} en la raspadita. CÃ³digo: ${code} Â· ${ts}`)}` };
}

// ===== Init =====
(function init(){
  // asignar 4 premios visibles
  const picks = makeFour(PRIZES_POOL);
  for(let i=0;i<4;i++){ document.getElementById('p'+i).textContent=picks[i]; attachScratch(tickets[i], i); }
  restoreIfPlayed();
})();
</script>
</body>
</html>
